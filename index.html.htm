<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provas B√≠blicas</title>

    <style>
        /* FOR√áA TEXTO EM MAI√öSCULO (APENAS VISUAL) */
        #nome-participante {
            text-transform: uppercase;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding-top: 60px;
            background: #f4f6f9;
        }

        h2 {
            text-align: center;
            margin: 20px 0;
        }

        /* MENU SUPERIOR FIXO */
        #topbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: #2c7be5;
            color: #fff;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 10000;
        }

        .menu-item {
            margin-right: 30px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
        }

        .menu-item:hover {
            text-decoration: underline;
        }

        /* DROPDOWN */
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #fff;
            min-width: 250px;
            /* aumenta para acomodar respostas longas */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            border-radius: 6px;
            overflow: hidden;
            z-index: 10001;
        }

        .dropdown-content div {
            padding: 12px;
            color: #333;
            cursor: pointer;
        }

        .dropdown-content div:hover {
            background: #f0f0f0;
        }

        .menu-item.dropdown:hover .dropdown-content {
            display: block;
        }

        /* MENU PRINCIPAL */
        #inicio {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: calc(100% - 60px);
            background: #f4f6f9;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .menu-box {
            width: 100%;
            max-width: 900px;
            background: #fff;
            padding: 25px;
            border-radius: 14px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /* 4 cards lado a lado */
            gap: 15px;
        }

        .menu-card {
            border: 2px solid #2c7be5;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .menu-card h3 {
            margin: 10px 0 5px;
        }

        .menu-card p {
            margin-bottom: 15px;
            font-size: 14px;
        }

        button {
            padding: 14px;
            font-size: 16px;
            width: 100%;
            background: #2c7be5;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        /* TELA DE IDENTIFICA√á√ÉO */
        #tela-identificacao {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: calc(100% - 60px);
            background: #f4f6f9;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            display: none;
        }

        #tela-identificacao .id-box {
            background: #fff;
            padding: 25px;
            border-radius: 14px;
            text-align: center;
            width: 90%;
            max-width: 500px;
            /* aumenta para respostas longas */
        }

        #tela-identificacao input {
            width: 90%;
            padding: 10px;
            margin: 15px 0;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        /* PROVA */
        #prova-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px;
            display: none;
            flex-wrap: wrap;
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 500px;
            /* aumenta para respostas longas */
        }

        .question {
            display: none;
            padding: 12px;
            border-radius: 8px;
            background: #fff;
            border: 2px solid #2c7be5;
            word-wrap: break-word;
        }

        .question.active {
            display: block;
        }

        #finalizar-btn {
            display: none;
            margin: 20px auto;
            width: 200px;
        }

        /* RESULTADO */
        #resultado {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10002;
        }

        .result-box {
            background: #fff;
            padding: 25px;
            width: 90%;
            max-width: 450px;
            border-radius: 14px;
            text-align: center;
        }

        .pontos {
            font-size: 44px;
            font-weight: bold;
            color: #2c7be5;
            margin: 10px 0;
        }

        .result-text {
            font-size: 16px;
            margin: 8px 0;
        }

        .result-btn {
            margin: 10px;
            padding: 10px 20px;
            width: 80%;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            background: #2c7be5;
            color: white;
            cursor: pointer;
        }

        /* RESULTADOS VISUALIZA√á√ÉO */
        #tela-resultados {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10003;
        }

        #tela-resultados .result-box {
            max-width: 700px;
            overflow-y: auto;
            max-height: 80%;
            text-align: left;
        }

        #tela-resultados .result-box h3 {
            text-align: center;
        }

        #tela-resultados .result-box div {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <!-- MENU SUPERIOR FIXO -->
    <div id="topbar">
        <div class="menu-item" onclick="mostrarMenu()">Menu Inicial</div>

        <div class="menu-item dropdown">
            Provas ‚ñº
            <div class="dropdown-content">
                <div onclick="mostrarIdentificacao(1)">Prova 1 ‚Äì Cria√ß√£o</div>
                <div onclick="mostrarIdentificacao(2)">Prova 2 ‚Äì Jardim do √âden</div>
                <div onclick="mostrarIdentificacao(3)">Prova 3 ‚Äì O Pecado</div>
                <div onclick="mostrarIdentificacao(4)">Prova 4 ‚Äì Filhos de Ad√£o e Eva</div>
                <div onclick="mostrarIdentificacao(5)">Prova 5 ‚Äì Guerra no C√©u</div>
            </div>
        </div>

        <div class="menu-item dropdown">
            Resultados ‚ñº
            <div class="dropdown-content" id="menu-resultados">
                <div>Nenhum resultado dispon√≠vel</div>
            </div>
        </div>
    </div>

    <!-- MENU PRINCIPAL -->
    <div id="inicio">
        <div class="menu-box">
            <div class="menu-grid">

                <div class="menu-card">
                    <h3>Prova 1</h3>
                    <p>A Cria√ß√£o</p>
                    <button onclick="mostrarIdentificacao(1)">INICIAR</button>
                </div>

                <div class="menu-card">
                    <h3>Prova 2</h3>
                    <p>O Jardim do √âden</p>
                    <button onclick="mostrarIdentificacao(2)">INICIAR</button>
                </div>

                <div class="menu-card">
                    <h3>Prova 3</h3>
                    <p>O Pecado</p>
                    <button onclick="mostrarIdentificacao(3)">INICIAR</button>
                </div>

                <div class="menu-card">
                    <h3>Prova 4</h3>
                    <p>Os filhos de Ad√£o e Eva</p>
                    <button onclick="mostrarIdentificacao(4)">INICIAR</button>
                </div>

                <div class="menu-card">
                    <h3>Prova 5 </h3>
                    <p>Guerra no C√©u</p>
                    <button onclick="mostrarIdentificacao(5)">INICIAR</button>
                </div>

            </div>
        </div>
    </div>

    <!-- TELA DE IDENTIFICA√á√ÉO -->
    <div id="tela-identificacao">
        <div class="id-box">
            <h3 id="id-titulo">Prova</h3>
            <p>Antes de come√ßar, digite seu nome:</p>
            <input type="text" id="nome-participante" placeholder="Nome do participante" oninput="this.value = this.value.toUpperCase()">
            <button onclick="iniciarProva()">INICIAR PROVA</button>
        </div>
    </div>

    <!-- PROVA -->
    <div id="prova-container">
        <div class="column" id="col-left"></div>
        <div class="column" id="col-right"></div>
    </div>

    <button id="finalizar-btn" onclick="finalizarProva()">Finalizar Prova</button>

    <!-- RESULTADO -->
    <div id="resultado">
        <div class="result-box">
            <h3 id="res-title">Resultado</h3>
            <div class="result-text" id="res-participante">Participante: </div>
            <div class="pontos" id="res-nota">0 / 10</div>
            <div class="result-text" id="res-tempo">Tempo: 0 segundos</div>
            <div class="result-text" id="res-status">Status: REPROVADO</div>
            <div class="result-text" id="res-msg">Voc√™ n√£o atingiu a nota m√≠nima.</div>
            <button class="result-btn" onclick="refazerProva()">REFAZER ESTA PROVA</button><br>
            <button class="result-btn" onclick="mostrarMenu()">VOLTAR AO MENU PRINCIPAL</button>
        </div>
    </div>

    <!-- TELA RESULTADOS -->
    <div id="tela-resultados">
        <div class="result-box">
            <h3>Resultados das Provas</h3>
            <div id="lista-resultados"></div>
            <button class="result-btn" onclick="fecharResultados()">VOLTAR AO MENU PRINCIPAL</button>
        </div>
    </div>

    <script>
        let inicioTempo;
        let atualProva = 1;
        let nomeParticipante = "";
        let resultados = {};

        /* GOOGLE SHEETS (API) */
        const GOOGLE_SHEETS_URL = "https://script.google.com/macros/s/AKfycbwTQlB-57ZPHr5U6nF2ALF3BkwaVZxG9QzU5duGvUz4WefT6OC4b9eFMu0eRhXvKfsERA/exec";

        const provas = {
            1: [ // Prova 1 ‚Äì A Cria√ß√£o
                ["Quem √© Deus?", ["Uma for√ßa", "Um poder", "Um esp√≠rito", "Todas as alternativas"], 3],
                ["Quais as 3 manifesta√ß√µes de Deus?", ["Deus", "Jesus", "Esp√≠rito Santo", "Todas as alternativas"], 3],
                ["Como Deus criou o planeta Terra?", ["Passe de m√°gica", "Soprou", "Pela sua palavra", "Chamou Ad√£o"], 2],
                ["Quantos dias Deus criou?", ["6 dias", "8 dias", "7 dias", "5 dias"], 2],
                ["Como a Terra estava antes da cria√ß√£o?", ["Escura", "Sem forma", "Vazia", "Todas as alternativas"], 3],
                ["O que Deus criou no sexto dia?", ["Lua e sol", "√Åguas e terra", "Plantas", "O homem e a mulher"], 3],
                ["O que Deus fez no s√©timo dia?", ["Aben√ßoou e santificou", "Descansou, aben√ßoou e santificou", "Somente descansou", "Nada"], 1],
                ["Primeiro homem criado por Deus?", ["Jesus", "√âden", "Ad√£o", "Abel"], 2],
                ["Primeira mulher?", ["Erva", "Eva", "Evra", "Ev√£"], 1],
                ["Presente dado por Deus?", ["Animais", "Cordeiro", "Jardim do √âden", "√Årvore da vida"], 2]
            ],
            2: [ // Prova 2 ‚Äì O Jardim do √âden
                ["Com quais animais Ad√£o e Eva conversavam no jardim?", ["Com o le√£o", "Com os p√°ssaros", "Com a serpente", "Nenhuma das alternativas pois eles n√£o falavam"], 3],
                ["Qual a fun√ß√£o de Ad√£o e Eva com o jardim?", ["Avisar Deus se uma √°rvore cair", "Fazer casas", "Cuidar", "Todas as alternativas"], 2],
                ["Qual aviso Deus deu para Ad√£o e Eva?", ["N√£o coma nenhum fruto de nenhuma √°rvore", "Coma do fruto da √°rvore do conhecimento do bem e do mal", "Ensine os animais a falarem", "Nenhuma das alternativas"], 3],
                ["O que aconteceu com Eva e a serpente?", ["Eles estavam conversando", "Eva deu um fruto para a serpente", "A serpente deu um fruto para Eva", "Eva chamou Ad√£o para expulsar a serpente"], 0],
                ["Quem comeu o fruto que n√£o poderia comer?", ["Eva e a serpente", "Eva, Ad√£o e a serpente", "Eva, Ad√£o e o Cordeiro", "Nenhuma das alternativas"], 3],
                ["Qual foi a frase de Deus para Ad√£o e Eva?", ["Coma todos os frutos das √°rvores do jardim livremente", "Coma somente o fruto da √°rvore da vida", "N√£o coma o fruto da √°rvore do entendimento do bem e do mal", "N√£o coma o fruto da √°rvore do conhecimento do bem e do mal"], 3],
                ["O que aconteceria se comer da √°rvore do conhecimento do bem e do mal?", ["Certamente a serpente morreria", "Certamente a √°rvore cairia", "Certamente morrer√°s", "Certamente vai sair do jardim do √âden"], 2],
                ["Qual foi a inten√ß√£o da serpente?", ["Mentir", "Mudar a ordem de Deus", "Enganar", "Todas as alternativas"], 3],
                ["Depois que Ad√£o e Eva comeram o fruto, o que aconteceu?", ["Eva e Ad√£o foram chamar Deus", "Eva se retirou e a serpente saiu voando", "Ad√£o achou Eva ca√≠da no jardim", "Nenhuma das alternativas"], 3],
                ["Quando Deus chamou Ad√£o e Eva, onde eles estavam?", ["Escondido em cima da maior √°rvore", "Escondidos atr√°s da √°rvore do conhecimento do bem e do mal", "Escondidos", "Escondidos perto do rio"], 2]
            ],
            3: [ // Prova 3 ‚Äì O Pecado
                ["Quem foi o animal usado por Satanas para falar com a mulher?", ["Um le√£o", "Um macaco", "Uma serpente", "Um p√°ssaro"], 2],
                ["Qual foi a primeira pergunta feita pela serpente √† mulher?", ["Deus criou todas as coisas?", "Foi assim que Deus disse: N√£o comereis de toda √°rvore do jardim?", "Onde est√° Ad√£o?", "Por que voc√™s est√£o no jardim?"], 1],
                ["O que a serpente disse que aconteceria se o fruto fosse comido?", ["Eles morreriam imediatamente", "Eles se tornariam anjos", "Seus olhos se abririam e seriam como Deus", "O jardim desapareceria"], 2],
                ["Ap√≥s comerem do fruto, o que aconteceu primeiro com Ad√£o e Eva?", ["Foram expulsos do jardim", "Seus olhos se abriram", "Deus apareceu imediatamente", "Eles dormiram"], 1],
                ["O que Ad√£o e Eva fizeram ao perceberem que estavam nus?", ["Costuraram folhas de figueira", "Usaram peles de animais", "Pediram roupas a Deus", "Fugiram do jardim"], 0],
                ["Onde Ad√£o e Eva se esconderam quando ouviram a voz de Deus?", ["Atr√°s das √°rvores do jardim", "Fora do jardim", "Dentro do rio", "Em uma caverna"], 0],
                ["Qual foi a justificativa de Ad√£o para ter comido do fruto?", ["A serpente o enganou", "Ele estava com fome", "A mulher que Deus lhe deu lhe ofereceu", "Ele n√£o sabia da ordem de Deus"], 2],
                ["Quem Eva culpou por ter comido do fruto?", ["Ad√£o", "Deus", "A serpente", "Ela mesma"], 2],
                ["Qual foi a maldi√ß√£o dada √† serpente?", ["Ser lan√ßada no fogo", "Perder a fala", "Andar sobre o ventre e comer p√≥", "Ser expulsa do jardim"], 2],
                ["O que Deus colocou no jardim ap√≥s expulsar o homem?", ["Um muro de fogo", "Um anjo com espada flamejante", "Um dil√∫vio", "Uma nuvem escura"], 1]
            ],
            4: [ // Prova 4 ‚Äì Filhos de Ad√£o e Eva
                ["Quem foram os dois primeiros filhos de Ad√£o e Eva mencionados em G√™nesis 4?", ["Cain e Abel", "Caim e Abel", "Kaim e Abeu", "Caim e Habel"], 1],
                ["Qual era a ocupa√ß√£o de Caim?", ["Pastor de ovelhas", "Ca√ßador", "Lavrador da terra", "Construtor"], 2],
                ["Qual era a ocupa√ß√£o de Abel?", ["Lavrador", "Pastor de ovelhas", "Pescador", "Comerciante"], 1],
                ["Qual oferta Deus aceitou?", ["A de Caim", "A de Abel", "As duas ofertas", "Nenhuma das ofertas"], 1],
                ["Como Caim reagiu quando Deus n√£o aceitou sua oferta?", ["Alegrou-se", "Ignorou", "Ficou muito irado", "Pediu perd√£o"], 2],
                ["O que Deus disse que o pecado estava fazendo?", ["Estava sendo perdoado", "Estava adormecido", "Estava √† porta, desejando domin√°-lo", "Estava distante do homem"], 2],
                ["O que Caim fez com Abel?", ["Planejou e matou ele", "Encontrou ele morto no jardim", "Encontrou ele morto no campo", "Sem querer matou ele"], 0],
                ["Onde Caim matou Abel?", ["Na cidade", "No templo", "No campo", "No jardim"], 2],
                ["Qual foi a resposta de Caim quando Deus perguntou por Abel?", ["Ele est√° no campo", "N√£o sei; sou eu guardador do meu irm√£o?", "Ele fugiu", "Ele morreu"], 1],
                ["Qual foi a consequ√™ncia direta imposta a Caim ap√≥s o assassinato?", ["Morte imediata", "Pris√£o", "Tornar-se fugitivo e errante", "Expuls√£o do √âden"], 2]
            ],
            5: [ // Prova 5 ‚Äì Guerra no C√©u
                ["Como √© descrito o anjo que iniciou guerra no C√©u?", ["Anjo mensageiro", "Querubim", "Arcanjo", "Gabriel"], 1],
                ["Qual foi o desejo expresso pelo ser querubim?", ["Servir aos homens", "Habitar acima dos anjos", "Guardar o trono de Deus", "Exaltar-se acima das estrelas de Deus"], 3],
                ["Esse querubim √© identificado como?", ["Um animal simb√≥lico", "Um querubim fiel", "Drag√£o, a antiga serpente, chamada Diabo e Satan√°s", "Um anjo de Miguel"], 2],
                ["O querubim desejou ser?", ["Poderoso mais que Deus", "Ter mais autoridade que Deus", "Tomar o trono de Deus", "Todas as alternativas"], 3],
                ["Quem lutou contra o drag√£o e seus anjos no c√©u?", ["Miguel e seus anjos", "Gabriel e seus anjos", "Os vinte e quatro anci√£os", "Os querubins do √âden"], 0],
                ["Qual foi o resultado da peleja no c√©u?", ["O querubim venceu", "O querubim perdeu o seu lugar no c√©u", "Houve empate", "O c√©u foi destru√≠do"], 1],
                ["Para onde o drag√£o e seus anjos foram lan√ßados ap√≥s a derrota?", ["Para o lago de fogo", "Para o abismo imediatamente", "Para a terra", "Para o deserto do Sinai"], 2],
                ["O que aconteceu com o drag√£o ap√≥s ser lan√ßado √† terra?", ["Passou a perseguir os habitantes da terra", "Perdeu todo o poder", "Foi destru√≠do imediatamente", "Voltou ao c√©u"], 0],
                ["Por que o diabo desce √† terra com grande ira?", ["Porque perdeu seus anjos", "Porque foi expulso do √âden", "Porque sabe que tem pouco tempo", "Porque perdeu seu poder"], 2],
                ["Qual verdade espiritual a peleja no c√©u revela?", ["Os anjos s√£o iguais aos homens", "Deus perdeu o controle por um tempo", "O c√©u pode ser destru√≠do", "O mal n√£o prevalece contra o prop√≥sito de Deus"], 3]
            ]
        };

        // ------------------ FUN√á√ïES ------------------

        function mostrarIdentificacao(prova) {
            atualProva = prova;
            document.getElementById("inicio").style.display = "none";
            document.getElementById("tela-identificacao").style.display = "flex";

            // Mapeamento completo das provas
            let titulo = "";
            switch (prova) {
                case 1:
                    titulo = "A Cria√ß√£o";
                    break;
                case 2:
                    titulo = "O Jardim do √âden";
                    break;
                case 3:
                    titulo = "O Pecado";
                    break;
                case 4:
                    titulo = "Os filhos de Ad√£o e Eva";
                    break;
                case 5:
                    titulo = "Guerra no C√©u";
                    break;
                default:
                    titulo = "Prova";
                    break;
            }

            document.getElementById("id-titulo").innerText = `Prova ${prova} ‚Äì ${titulo}`;

            // üîπ FOCO AUTOM√ÅTICO NO CAMPO NOME
            setTimeout(() => {
                document.getElementById("nome-participante").focus();
            }, 0);
        }

        function iniciarProva() {
            let nome = document.getElementById("nome-participante").value.trim();
            if (nome === "") {
                alert("Digite seu nome antes de iniciar a prova.");
                return;
            }

            nome = nome.toUpperCase(); // GARANTIA FINAL
            nomeParticipante = nome;

            document.getElementById("nome-participante").value = nome;
            document.getElementById("tela-identificacao").style.display = "none";
            document.getElementById("prova-container").style.display = "flex";
            inicioTempo = Date.now();
            gerarProva();
        }

        function gerarProva() {
            const colLeft = document.getElementById("col-left");
            const colRight = document.getElementById("col-right");
            colLeft.innerHTML = "";
            colRight.innerHTML = "";
            const provaAtual = provas[atualProva];
            provaAtual.forEach((p, i) => {
                const div = document.createElement("div");
                div.className = "question";
                div.id = "q" + (i + 1);
                div.innerHTML = `<b>${i+1}. ${p[0]}</b><br>`;
                p[1].forEach((alt, j) => {
                    div.innerHTML += `<label><input type="radio" name="q${i+1}" value="${j===p[2]?1:0}"> ${alt}</label><br>`;
                });
                if (i < Math.ceil(provaAtual.length / 2)) colLeft.appendChild(div);
                else colRight.appendChild(div);
                div.querySelectorAll("input").forEach(input => {
                    input.addEventListener("change", () => {
                        div.classList.add("active");
                        if (i < provaAtual.length - 1) {
                            document.getElementById("q" + (i + 2)).classList.add("active");
                        } else {
                            document.getElementById("finalizar-btn").style.display = "block";
                        }
                    });
                });
            });
            document.getElementById("q1").classList.add("active");
            document.getElementById("finalizar-btn").style.display = "none";
        }

        function finalizarProva() {
            let nota = 0;
            let respostas = {};
            const provaAtual = provas[atualProva];

            for (let i = 1; i <= provaAtual.length; i++) {
                const q = document.getElementsByName("q" + i);
                q.forEach((input, index) => {
                    if (input.checked) {
                        nota += parseInt(input.value);
                        respostas["q" + i] = input.value;
                        respostas["q" + i + "-index"] = index;
                    }
                });
                if (!respostas["q" + i]) respostas["q" + i] = "";
            }

            const tempo = Math.floor((Date.now() - inicioTempo) / 1000);
            const dataAtual = new Date().toLocaleString();

            if (!resultados[`Prova ${atualProva}`]) {
                resultados[`Prova ${atualProva}`] = {};
            }

            resultados[`Prova ${atualProva}`][nomeParticipante] = {
                respostas,
                nota,
                tempo,
                data: dataAtual
            };

            /* ===== ENVIO PARA GOOGLE SHEETS ===== */
            const payload = {
                data: dataAtual,
                prova: `Prova ${atualProva}`,
                participante: nomeParticipante,
                nota: nota,
                tempo: tempo,
                respostas: respostas
            };

            enviarParaGoogleSheets(payload);
            /* =================================== */

            atualizarMenuResultados();
            mostrarResultadoIndividual(`Prova ${atualProva}`, nomeParticipante);
        }

        function enviarParaGoogleSheets(dados) {
            fetch(GOOGLE_SHEETS_URL, {
                    method: "POST",
                    body: JSON.stringify(dados)
                })
                .then(res => res.json())
                .then(ret => {
                    if (ret.status !== "ok") {
                        console.warn("Google Sheets respondeu, mas n√£o confirmou OK:", ret);
                    }
                })
                .catch(err => {
                    console.error("Erro ao enviar dados para Google Sheets:", err);
                });
        }

        function atualizarMenuResultados() {
            const menu = document.getElementById("menu-resultados");
            menu.innerHTML = "";
            if (Object.keys(resultados).length === 0) {
                menu.innerHTML = "<div>Nenhum resultado dispon√≠vel</div>";
                return;
            }
            for (let prova in resultados) {
                for (let participante in resultados[prova]) {
                    const div = document.createElement("div");
                    div.innerText = `${prova} ‚Äì ${participante}`;
                    div.style.cursor = "pointer";
                    div.onclick = () => mostrarResultadoCompleto(prova, participante);
                    menu.appendChild(div);
                }
            }
        }

        function mostrarResultadoIndividual(prova, participante) {
            const dados = resultados[prova][participante];
            const status = dados.nota >= 7 ? "APROVADO" : "REPROVADO";
            document.getElementById("res-title").innerText = `Resultado ‚Äî ${prova}`;
            document.getElementById("res-participante").innerText = `Participante: ${participante}`;
            document.getElementById("res-nota").innerText = dados.nota; // somente n√∫mero de acertos
            document.getElementById("res-tempo").innerText = `Tempo: ${dados.tempo} segundos`;
            document.getElementById("res-status").innerText = `Status: ${status}`;
            document.getElementById("res-msg").innerText = status === "APROVADO" ? "Parab√©ns! Voc√™ foi aprovado." : "Voc√™ n√£o atingiu a nota m√≠nima.";
            document.getElementById("resultado").style.display = "flex";
        }

        function mostrarResultadoCompleto(prova, participante) {
            const dados = resultados[prova][participante];
            const provaAtual = provas[parseInt(prova.split(" ")[1])]; // pega as quest√µes
            const listaResultados = document.getElementById("lista-resultados");
            listaResultados.innerHTML = `<h3>${prova} ‚Äì ${participante}</h3>`;

            provaAtual.forEach((questao, i) => {
                const numero = i + 1;
                const div = document.createElement("div");
                div.style.border = "2px solid #2c7be5"; // borda azul
                div.style.borderRadius = "8px";
                div.style.padding = "12px";
                div.style.marginBottom = "12px";

                let alternativasHTML = "";
                const respostaUsuario = dados.respostas["q" + numero];
                const indiceCorreto = questao[2];
                const acertou = respostaUsuario == 1; // se marcou correta

                questao[1].forEach((alt, j) => {
                    const valorCorreto = (j === indiceCorreto);
                    // Apenas seleciona o radio se for a resposta do usu√°rio
                    const marcado = (!acertou && respostaUsuario == 0 && j === parseInt(dados.respostas["q" + numero + "-index"])) ||
                        (acertou && valorCorreto);

                    alternativasHTML += `
        <label style="display:block; padding:6px; border-radius:4px;">
          <input type="radio" disabled ${marcado ? "checked" : ""}> ${alt}
        </label>
      `;
                });

                // Define fundo do bloco
                div.style.backgroundColor = acertou ? "#d4edda" : "#f8d7da";

                // Linha extra
                div.innerHTML = `<b>${numero}. ${questao[0]}</b><br>${alternativasHTML}`;
                if (!acertou) {
                    div.innerHTML += `<br><b>Resposta correta: ${String.fromCharCode(65 + indiceCorreto)}</b>`;
                }

                listaResultados.appendChild(div);
            });

            document.getElementById("tela-resultados").style.display = "flex";
        }


        function refazerProva() {
            document.getElementById("resultado").style.display = "none";
            document.getElementById("prova-container").style.display = "none";
            document.getElementById("tela-identificacao").style.display = "flex";
            document.getElementById("nome-participante").value = "";
        }

        function mostrarMenu() {
            document.getElementById("inicio").style.display = "flex";
            document.getElementById("tela-identificacao").style.display = "none";
            document.getElementById("prova-container").style.display = "none";
            document.getElementById("resultado").style.display = "none";
        }

        function fecharResultados() {
            document.getElementById("tela-resultados").style.display = "none";
            mostrarMenu();
        }

        /* PEGA DADOS DA PLANILHA RESULTADOS DO GOOGLE SHEETS E MOSTRA NO HTML */
        function carregarResultadosDoSheets() {
            fetch(GOOGLE_SHEETS_URL, {
                    method: "GET"
                })
                .then(res => res.json())
                .then(dados => {
                    // Se o Apps Script retornar erro em formato objeto:
                    if (dados && dados.status === "error") {
                        console.error("Sheets error:", dados.message);
                        return;
                    }

                    resultados = {};

                    dados.forEach(item => {
                        if (!resultados[item.prova]) resultados[item.prova] = {};

                        resultados[item.prova][item.participante] = {
                            nota: item.nota,
                            tempo: item.tempo,
                            data: item.data,
                            respostas: item.respostas || {} // j√° vem objeto
                        };
                    });

                    atualizarMenuResultados();
                })
                .catch(err => {
                    console.error("Erro ao carregar resultados do Sheets:", err);
                });
        }

        window.onload = function() {
            carregarResultadosDoSheets();
        };

        // Atalho ESC para voltar ao menu principal
        document.addEventListener("keydown", function(event) {
            if (event.key === "Escape") {
                mostrarMenu();
            }
        });
    </script>

</body>

</html>